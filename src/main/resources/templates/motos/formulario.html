<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/header :: head}">
    <title th:if="${moto.id != null}">Editar Moto - MotoVision</title>
    <title th:unless="${moto.id != null}">Nova Moto - MotoVision</title>
  </head>
  <body>
    <div th:replace="~{fragments/header :: navbar}"></div>

    <div class="container-fluid">
      <div class="row">
        <div
          class="col-md-2 p-0"
          th:replace="~{fragments/menu :: sidebar}"
        ></div>
        <div class="col-md-10">
          <main class="p-4">
            <!-- Mensagens -->
            <div
              th:if="${success}"
              class="alert alert-success alert-dismissible fade show"
              role="alert"
            >
              <i class="fas fa-check-circle me-2"></i>
              <span th:text="${success}"></span>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
              ></button>
            </div>

            <div
              th:if="${error}"
              class="alert alert-danger alert-dismissible fade show"
              role="alert"
            >
              <i class="fas fa-exclamation-triangle me-2"></i>
              <span th:text="${error}"></span>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
              ></button>
            </div>

            <!-- Cabeçalho -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <div>
                <h1 class="h3 mb-0">
                  <i class="fas fa-motorcycle me-2"></i>
                  <span
                    th:text="${moto.id != null ? 'Editar Moto' : 'Nova Moto'}"
                    >Nova Moto</span
                  >
                </h1>
                <p class="text-muted">
                  <span
                    th:text="${moto.id != null ? 'Edite os dados da moto' : 'Preencha os dados da nova moto'}"
                    >Preencha os dados da nova moto</span
                  >
                </p>
              </div>
            </div>

            <!-- Formulário -->
            <div class="row">
              <div class="col-md-8">
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title mb-0">
                      <i class="fas fa-edit me-2"></i>Dados da Moto
                    </h5>
                  </div>
                  <div class="card-body">
                    <form
                      th:action="${moto.id != null ? '/motos/' + moto.id : '/motos'}"
                      th:object="${moto}"
                      method="post"
                    >
                      <input
                        type="hidden"
                        th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}"
                      />

                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="modelo" class="form-label">
                              <i class="fas fa-motorcycle me-1"></i>Modelo *
                            </label>
                            <input
                              type="text"
                              class="form-control"
                              id="modelo"
                              th:field="*{modelo}"
                              placeholder="Ex: Honda PCX 160"
                              required
                            />
                            <div
                              th:if="${#fields.hasErrors('modelo')}"
                              class="text-danger"
                            >
                              <small th:errors="*{modelo}"></small>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="placa" class="form-label">
                              <i class="fas fa-id-card me-1"></i>Placa *
                            </label>
                            <input
                              type="text"
                              class="form-control"
                              id="placa"
                              th:field="*{placa}"
                              placeholder="Ex: ABC1234"
                              required
                            />
                            <div
                              th:if="${#fields.hasErrors('placa')}"
                              class="text-danger"
                            >
                              <small th:errors="*{placa}"></small>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="status" class="form-label">
                              <i class="fas fa-info-circle me-1"></i>Status *
                            </label>
                            <select
                              class="form-select"
                              id="status"
                              th:field="*{status}"
                              required
                            >
                              <option value="">Selecione o status</option>
                              <option
                                th:each="status : ${statusList}"
                                th:value="${status}"
                                th:text="${status}"
                              ></option>
                            </select>
                            <div
                              th:if="${#fields.hasErrors('status')}"
                              class="text-danger"
                            >
                              <small th:errors="*{status}"></small>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="patio" class="form-label">
                              <i class="fas fa-warehouse me-1"></i>Pátio *
                            </label>
                            <select
                              class="form-select"
                              id="patio"
                              name="patio.id"
                              th:attr="data-selected-id=${moto.patio != null ? moto.patio.id : ''}"
                              required
                            >
                              <option value="">Selecione o pátio</option>
                              <option
                                th:each="patio : ${patios}"
                                th:value="${patio.id}"
                                th:text="${patio.nome}"
                              ></option>
                            </select>
                            <div
                              th:if="${#fields.hasErrors('patio')}"
                              class="text-danger"
                            >
                              <small th:errors="*{patio}"></small>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="setor" class="form-label">
                              <i class="fas fa-map-marker-alt me-1"></i>Setor
                            </label>
                            <input
                              type="text"
                              class="form-control"
                              id="setor"
                              th:field="*{setor}"
                              readonly
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="corSetor" class="form-label">
                              <i class="fas fa-palette me-1"></i>Cor do Setor
                            </label>
                            <input
                              type="text"
                              class="form-control"
                              id="corSetor"
                              th:field="*{corSetor}"
                              readonly
                            />
                          </div>
                        </div>
                      </div>

                      <div class="mb-3">
                        <label for="descricao" class="form-label">
                          <i class="fas fa-align-left me-1"></i>Descrição
                        </label>
                        <textarea
                          class="form-control"
                          id="descricao"
                          th:field="*{descricao}"
                          rows="3"
                          placeholder="Descrição da moto (opcional)"
                        ></textarea>
                        <div
                          th:if="${#fields.hasErrors('descricao')}"
                          class="text-danger"
                        >
                          <small th:errors="*{descricao}"></small>
                        </div>
                      </div>

                      <!-- Botões -->
                      <div class="d-flex justify-content-between mt-4">
                        <a href="/motos" class="btn btn-secondary btn-lg">
                          <i class="fas fa-times me-2"></i>CANCELAR
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                          <i class="fas fa-save me-2"></i>SALVAR
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
      // Atualizar setor e cor automaticamente quando o status mudar
      document.addEventListener("DOMContentLoaded", function () {
        // Selecionar o pátio correto se estiver editando
        var patioSelect = document.getElementById("patio");
        if (patioSelect) {
          var selectedId = patioSelect.getAttribute("data-selected-id");
          if (selectedId && selectedId !== "") {
            patioSelect.value = selectedId;
          }
        }

        var statusSelect = document.getElementById("status");
        if (statusSelect) {
          function updateSetorCor() {
            var status = statusSelect.value;
            var setorField = document.getElementById("setor");
            var corField = document.getElementById("corSetor");

            var statusMap = {
              DISPONIVEL: { setor: "Setor A", cor: "Verde" },
              RESERVADA: { setor: "Setor B", cor: "Azul" },
              MANUTENCAO: { setor: "Setor C", cor: "Amarelo" },
              FALTA_PECA: { setor: "Setor D", cor: "Laranja" },
              INDISPONIVEL: { setor: "Setor E", cor: "Cinza" },
              DANOS_ESTRUTURAIS: { setor: "Setor F", cor: "Vermelho" },
              SINISTRO: { setor: "Setor G", cor: "Preto" },
            };

            if (statusMap[status] && setorField && corField) {
              setorField.value = statusMap[status].setor;
              corField.value = statusMap[status].cor;
            }
          }

          statusSelect.addEventListener("change", updateSetorCor);

          // Executar na carga da página se já houver um status selecionado
          if (statusSelect.value) {
            updateSetorCor();
          }
        }
      });
    </script>
  </body>
</html>
