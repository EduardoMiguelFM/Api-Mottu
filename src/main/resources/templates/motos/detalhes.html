<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/header :: head}">
    <title>Detalhes da Moto - MotoVision</title>
  </head>
  <body>
    <div th:replace="~{fragments/header :: navbar}"></div>

    <div class="container-fluid">
      <div class="row">
        <div
          class="col-md-2 p-0"
          th:replace="~{fragments/menu :: sidebar}"
        ></div>
        <div class="col-md-10">
          <main class="p-4">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <div>
                <h1 class="h3 mb-0">
                  <i class="fas fa-motorcycle me-2 text-primary"></i>
                  Detalhes da Moto
                </h1>
                <p class="text-muted">
                  <span th:text="${moto.modelo}">Modelo</span> -
                  <span th:text="${moto.placa}">Placa</span>
                </p>
              </div>
              <div>
                <a href="/motos" class="btn btn-outline-secondary">
                  <i class="fas fa-arrow-left me-1"></i>Voltar
                </a>
                <a
                  th:href="@{/motos/editar/{id}(id=${moto.id})}"
                  class="btn btn-warning"
                >
                  <i class="fas fa-edit me-1"></i>Editar
                </a>
              </div>
            </div>

            <!-- Informações da Moto -->
            <div class="row">
              <div class="col-md-8">
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title mb-0">
                      <i class="fas fa-info-circle me-2"></i>Informações da Moto
                    </h5>
                  </div>
                  <div class="card-body">
                    <dl class="row">
                      <dt class="col-sm-3">ID:</dt>
                      <dd class="col-sm-9" th:text="${moto.id}">1</dd>

                      <dt class="col-sm-3">Modelo:</dt>
                      <dd class="col-sm-9" th:text="${moto.modelo}">
                        Honda CG
                      </dd>

                      <dt class="col-sm-3">Placa:</dt>
                      <dd class="col-sm-9">
                        <span
                          class="badge bg-secondary fs-6"
                          th:text="${moto.placa}"
                          >ABC1234</span
                        >
                      </dd>

                      <dt class="col-sm-3">Status:</dt>
                      <dd class="col-sm-9">
                        <span
                          th:if="${moto.status.name() == 'DISPONIVEL'}"
                          class="badge bg-success fs-6"
                          th:text="${moto.status.descricao}"
                          >Disponível</span
                        >
                        <span
                          th:if="${moto.status.name() == 'RESERVADA'}"
                          class="badge bg-primary fs-6"
                          th:text="${moto.status.descricao}"
                          >Reservada</span
                        >
                        <span
                          th:if="${moto.status.name() == 'MANUTENCAO'}"
                          class="badge bg-warning fs-6"
                          th:text="${moto.status.descricao}"
                          >Manutenção</span
                        >
                        <span
                          th:if="${moto.status.name() == 'FALTA_PECA'}"
                          class="badge fs-6"
                          style="background-color: #fd7e14; color: white"
                          th:text="${moto.status.descricao}"
                          >Falta Peça</span
                        >
                        <span
                          th:if="${moto.status.name() == 'INDISPONIVEL'}"
                          class="badge bg-secondary fs-6"
                          th:text="${moto.status.descricao}"
                          >Indisponível</span
                        >
                        <span
                          th:if="${moto.status.name() == 'DANOS_ESTRUTURAIS'}"
                          class="badge bg-danger fs-6"
                          th:text="${moto.status.descricao}"
                          >Danos Estruturais</span
                        >
                        <span
                          th:if="${moto.status.name() == 'SINISTRO'}"
                          class="badge bg-dark fs-6"
                          th:text="${moto.status.descricao}"
                          >Sinistro</span
                        >
                      </dd>

                      <dt class="col-sm-3">Setor:</dt>
                      <dd class="col-sm-9" th:text="${moto.setor}">Setor A</dd>

                      <dt class="col-sm-3">Cor do Setor:</dt>
                      <dd class="col-sm-9">
                        <span
                          th:if="${moto.corSetor == 'Verde'}"
                          class="badge fs-6"
                          style="background-color: green"
                          th:text="${moto.corSetor}"
                          >Verde</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Azul'}"
                          class="badge fs-6"
                          style="background-color: blue"
                          th:text="${moto.corSetor}"
                          >Azul</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Amarelo'}"
                          class="badge fs-6"
                          style="background-color: yellow"
                          th:text="${moto.corSetor}"
                          >Amarelo</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Laranja'}"
                          class="badge fs-6"
                          style="background-color: orange"
                          th:text="${moto.corSetor}"
                          >Laranja</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Cinza'}"
                          class="badge fs-6"
                          style="background-color: gray"
                          th:text="${moto.corSetor}"
                          >Cinza</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Vermelho'}"
                          class="badge fs-6"
                          style="background-color: red"
                          th:text="${moto.corSetor}"
                          >Vermelho</span
                        >
                        <span
                          th:if="${moto.corSetor == 'Preto'}"
                          class="badge fs-6"
                          style="background-color: black"
                          th:text="${moto.corSetor}"
                          >Preto</span
                        >
                      </dd>

                      <dt class="col-sm-3">Descrição:</dt>
                      <dd
                        class="col-sm-9"
                        th:text="${moto.descricao ?: 'Nenhuma descrição informada'}"
                      >
                        Moto em bom estado, revisada recentemente
                      </dd>

                      <dt class="col-sm-3">Pátio:</dt>
                      <dd class="col-sm-9">
                        <a
                          th:href="@{/patios/detalhes/{id}(id=${moto.patio.id})}"
                          class="text-decoration-none"
                        >
                          <i class="fas fa-warehouse me-1"></i>
                          <span th:text="${moto.patio.nome}"
                            >Pátio Central</span
                          >
                        </a>
                      </dd>

                      <dt class="col-sm-3">Endereço do Pátio:</dt>
                      <dd
                        class="col-sm-9"
                        th:text="${moto.patio.endereco ?: 'Endereço não informado'}"
                      >
                        Rua das Flores, 123
                      </dd>
                    </dl>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title mb-0">
                      <i class="fas fa-clock me-2"></i>Histórico
                    </h5>
                  </div>
                  <div class="card-body">
                    <dl class="row">
                      <dt class="col-sm-5">Criado em:</dt>
                      <dd
                        class="col-sm-7"
                        th:text="${#temporals.format(moto.createdAt, 'dd/MM/yyyy HH:mm')}"
                      >
                        27/09/2025 22:21
                      </dd>

                      <dt class="col-sm-5">Atualizado em:</dt>
                      <dd
                        class="col-sm-7"
                        th:text="${#temporals.format(moto.updatedAt, 'dd/MM/yyyy HH:mm')}"
                      >
                        27/09/2025 22:21
                      </dd>
                    </dl>
                  </div>
                </div>

                <div class="card mt-3">
                  <div class="card-header">
                    <h5 class="card-title mb-0">
                      <i class="fas fa-tools me-2"></i>Ações
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="d-grid gap-2">
                      <a
                        th:href="@{/motos/editar/{id}(id=${moto.id})}"
                        class="btn btn-warning"
                      >
                        <i class="fas fa-edit me-1"></i>Editar Moto
                      </a>
                      <a
                        th:href="@{/patios/detalhes/{id}(id=${moto.patio.id})}"
                        class="btn btn-info"
                      >
                        <i class="fas fa-warehouse me-1"></i>Ver Pátio
                      </a>
                      <button
                        type="button"
                        class="btn btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteModal"
                      >
                        <i class="fas fa-trash me-1"></i>Excluir Moto
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal de Confirmação de Exclusão -->
            <div
              class="modal fade"
              id="deleteModal"
              tabindex="-1"
              aria-labelledby="deleteModalLabel"
              aria-modal="true"
              role="dialog"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">
                      Confirmar Exclusão
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                      onclick="fecharModalDetalhes()"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <p>
                      Tem certeza que deseja excluir a moto
                      <strong th:text="${moto.modelo}">Modelo</strong> -
                      <strong th:text="${moto.placa}">Placa</strong>?
                    </p>
                    <p class="text-danger">
                      <small>Esta ação não pode ser desfeita.</small>
                    </p>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                      onclick="fecharModalDetalhes()"
                    >
                      Cancelar
                    </button>
                    <form
                      th:action="@{/motos/deletar/{id}(id=${moto.id})}"
                      method="post"
                      class="d-inline"
                      id="deleteFormDetalhes"
                    >
                      <input
                        type="hidden"
                        th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}"
                      />
                      <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Excluir
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
      // Função para fechar modal de detalhes
      function fecharModalDetalhes() {
        const modalElement = document.getElementById("deleteModal");
        if (modalElement) {
          if (typeof bootstrap !== "undefined") {
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) {
              modal.hide();
            } else {
              const newModal = new bootstrap.Modal(modalElement);
              newModal.hide();
            }
            // Restaurar aria-hidden quando fechar
            modalElement.setAttribute("aria-hidden", "true");
            modalElement.removeAttribute("aria-modal");
          } else {
            // Fallback manual
            modalElement.style.display = "none";
            modalElement.classList.remove("show");
            modalElement.classList.add("fade");
            modalElement.setAttribute("aria-hidden", "true");
            modalElement.removeAttribute("aria-modal");
            document.body.classList.remove("modal-open");
            const allBackdrops = document.querySelectorAll(".modal-backdrop");
            allBackdrops.forEach((b) => b.remove());
          }
        }
      }

      // Gerenciar estado ARIA do modal e garantir que funcione
      document.addEventListener("DOMContentLoaded", function () {
        const modalElement = document.getElementById("deleteModal");
        if (modalElement) {
          // Quando modal estiver prestes a abrir, garantir estado correto
          modalElement.addEventListener("show.bs.modal", function () {
            modalElement.removeAttribute("aria-hidden");
            modalElement.setAttribute("aria-modal", "true");
          });

          // Quando modal abrir completamente, garantir estado correto
          modalElement.addEventListener("shown.bs.modal", function () {
            modalElement.removeAttribute("aria-hidden");
            modalElement.setAttribute("aria-modal", "true");
          });

          // Quando modal fechar, restaurar aria-hidden
          modalElement.addEventListener("hidden.bs.modal", function () {
            modalElement.setAttribute("aria-hidden", "true");
            modalElement.removeAttribute("aria-modal");
            document.body.classList.remove("modal-open");
            const allBackdrops = document.querySelectorAll(".modal-backdrop");
            allBackdrops.forEach((b) => b.remove());
          });
        }
      });
    </script>
  </body>
</html>
